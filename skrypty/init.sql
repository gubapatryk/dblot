CREATE DATABASE jednostka;

-- UÅ¼yj baze danych
\c jednostka;

CREATE SCHEMA raporty;


CREATE TABLE raporty.instytucje_szkoleniowe (
    id SERIAL PRIMARY KEY,
    nazwa TEXT NOT NULL
);

CREATE TABLE raporty.instytucje_medyczne (
    id SERIAL PRIMARY KEY,
    nazwa TEXT NOT NULL
);

CREATE TABLE raporty.kategoria_lotow (
    id SERIAL PRIMARY KEY,
    nazwa TEXT NOT NULL
);

CREATE TABLE raporty.modele_maszyn (
    id SERIAL PRIMARY KEY,
    nazwa TEXT NOT NULL
);

CREATE TABLE raporty.maszyny (
    rejestracja SERIAL PRIMARY KEY,
    id_modelu INT REFERENCES raporty.modele_maszyn(id) NOT NULL
);

-- managera musisz dodac


CREATE TABLE raporty.pracownicy (
    id VARCHAR(5) PRIMARY KEY,
    zespol INT REFERENCES raporty.zespoly(id),
    imie TEXT NOT NULL,
    nazwisko TEXT NOT NULL
);

CREATE TABLE raporty.zespoly (
    id SERIAL PRIMARY KEY,
    nazwa TEXT,
    id_kierownika VARCHAR(5) REFERENCES raporty.pracownicy(id)
);

CREATE TABLE raporty.szkolenia (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_instytucji INT REFERENCES raporty.instytucje_szkoleniowe(id) NOT NULL,
    id_pracownika VARCHAR(5) REFERENCES raporty.pracownicy(id) NOT NULL,
    nazwa TEXT NOT NULL,
    data_aktualizacji DATE NOT NULL,
    data_waznosci DATE NOT NULL
);

CREATE TABLE raporty.badania (
    id SERIAL PRIMARY KEY,
    id_instytucji INT REFERENCES raporty.instytucje_medyczne(id) NOT NULL,
    id_pracownika VARCHAR(5) REFERENCES raporty.pracownicy(id) NOT NULL,
    nazwa TEXT NOT NULL,
    data_aktualizacji DATE NOT NULL,
    data_waznosci DATE NOT NULL
);

CREATE TABLE raporty.loty (
    id SERIAL PRIMARY KEY,
    pilot1 VARCHAR(5) REFERENCES raporty.pracownicy(id) NOT NULL,
    pilot2 VARCHAR(5) REFERENCES raporty.pracownicy(id),
    kategoria INT REFERENCES raporty.kategoria_lotow(id) NOT NULL,
    rejestracja TEXT REFERENCES raporty.maszyny(rejestracja) NOT NULL,
    godzina_wylotu DATE NOT NULL,
    godzina_ladowania DATE NOT NULL
);


CREATE ROLE dowodca;
GRANT ALL PRIVILEGES ON DATABASE jednostka TO dowodca;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA raporty TO dowodca;
GRANT USAGE on SCHEMA raporty TO dowodca;
GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE raporty.pracownicy TO dowodca;

CREATE USER andrzej WITH PASSWORD 'andrzej';
GRANT dowodca TO andrzej;

INSERT INTO raporty.pracownicy (first_name, last_name)
VALUES ('Jan', 'Kowalski');
